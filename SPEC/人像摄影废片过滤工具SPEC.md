# 人像摄影质量检测工具 SPEC 文档

## 1. 项目概述

### 1.1 项目背景
在专业人像摄影中，摄影师通常会拍摄大量照片，其中包含大量废片（如闭眼、模糊、表情不佳等）。手动筛选这些照片既耗时又容易出错。本项目旨在开发一个自动化工具，帮助摄影师快速筛选和过滤人像摄影中的废片。

### 1.2 项目目标
- 自动检测和标记人像摄影中的废片
- 提供多维度的质量评估指标
- 支持批量处理大量照片
- 提供直观的结果展示和导出功能
- 减少人工筛选时间至少 80%

### 1.3 目标用户
- 专业人像摄影师
- 婚礼摄影师
- 商业摄影工作室
- 个人摄影爱好者

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 废片检测
**闭眼检测**
- 检测人物眼睛是否闭合
- 支持多人像场景中的多目标检测
- 提供闭眼程度的量化评分（0-100%）
- 阈值可配置

**模糊检测**
- 检测照片整体模糊程度
- 检测人物面部模糊程度
- 使用拉普拉斯方差等方法评估清晰度
- 提供模糊评分（0-100分）

**表情检测**
- 检测不自然或糟糕的表情
- 基于面部关键点分析表情质量
- 提供表情质量评分

**曝光检测**
- 检测过曝或欠曝照片
- 评估整体曝光质量
- 检测面部区域曝光是否合适
- 提供曝光评分

#### 2.1.2 批量处理
- 支持选择文件夹批量导入照片
- 支持常见图片格式（JPG, PNG, HEIC, RAW等）
- 显示处理进度
- 支持暂停、继续、取消操作
- 多线程/多进程处理以提高效率

#### 2.1.3 结果展示
- 以缩略图网格形式展示所有照片
- 不同标记类型的照片使用不同颜色标识
- 显示每张照片的详细评分信息
- 支持按评分、标签等条件筛选
- 支持图片放大预览
- 显示检测到的问题具体描述

#### 2.1.4 导出与管理
- 将废片移动到单独的文件夹
- 将优质照片移动到单独的文件夹
- 保留原照片文件夹结构
- 生成详细的筛选报告（CSV/JSON格式）
- 支持自定义导出规则

### 2.2 辅助功能

#### 2.2.1 配置管理
- 保存用户偏好设置
- 自定义各项检测阈值
- 保存常用的筛选规则
- 导入/导出配置文件

#### 2.2.2 历史记录
- 记录每次筛选任务
- 查看历史筛选结果
- 支持撤销/重做操作
- 查看处理统计信息

## 3. 非功能需求

### 3.1 性能要求
- 单张照片处理时间 < 2秒（1080P分辨率）
- 支持4000+张照片的批量处理
- 内存占用 < 6GB
- CPU利用率合理，不卡顿系统

### 3.2 准确性要求
- 闭眼检测准确率 > 90%
- 模糊检测准确率 > 85%
- 表情检测准确率 > 80%
- 整体误判率 < 10%

### 3.3 可靠性要求
- 程序崩溃率 < 0.1%
- 异常情况有明确提示
- 提供详细的日志记录

### 3.4 兼容性要求
- 支持Windows 10/11
- 支持macOS 11+
- 支持常见图片格式
- 支持RAW格式（至少主流相机品牌）

## 4. 技术方案

### 4.1 技术栈选择
本程序为单机版桌面应用，在本地运行，无后端，用户界面使用PyQt开发
#### 编程语言
- **Python 3.14+**: 主要开发语言
  - 丰富的图像处理库
  - 机器学习/深度学习生态完善
  - 跨平台支持好

#### 核心库
- **OpenCV**: 图像处理基础
- **Pillow/PIL**: 图片读写和基础处理
- **NumPy**: 数值计算
- **scikit-image**: 图像质量评估算法
- **YOLO26** 人脸检测和关键点提取

### 4.2 系统架构

```
┌─────────────────────────────────────────┐
│          主界面                        │
│  ┌─────────────────────────────────┐   │
│  │  照片上传  - 结果展示  - 配置   │   │
│  │  照片网格  - 筛选  - 手动标记   │   │
│  │  导出管理  - 历史记录           │   │
│  └──────────────┬──────────────────┘   │
└─────────────────┼───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│          业务逻辑层                      │
│  - 任务调度  - 数据管理  - 结果处理     │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│          检测引擎层                      │
│  ┌──────┬──────┬──────┬─────┬           │
│  │闭眼  │模糊  │表情  │曝光   │           │
│  │检测  │检测  │检测  │检测   │           │
│  └──────┴──────┴──────┴─────┴           │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│          数据访问层                      │
│  - 文件读写  - 数据存储  - 配置管理       │
└─────────────────────────────────────────┘
```